import{a as J,d as L,u as G,c as H}from"./schools-DEBpxMRk.js";import{d as K,ag as O,r as n,ah as Q,o as W,b as X,i as o,w as l,ai as Y,e as h,ak as Z,k as u,t as c,av as ee,J as ae,al as oe,am as le,aj as te,an as w,h as z}from"./index-TzivwsyV.js";import{E as se,b as ne,a as re,e as ce,h as de}from"./index-q58DMnPQ.js";import{v as ie}from"./directive-C-1OC64t.js";const ue={class:"space-y-4"},me={class:"flex items-center justify-end"},pe={class:"flex items-center"},ve={class:"flex justify-end mt-4"},be=K({__name:"SchoolAdminView",setup(fe){const{t:d}=O(),g=n([]),b=n(!0),i=n(!1),m=n(!1),r=n({name:"",password:""}),v=n(null),f=n(1),y=n(20),C=n(0),k=n(),B=Q({name:[{required:!0,message:"Name is required",trigger:"blur"}],password:[{required:!0,message:"Password is required for new schools",trigger:"blur"}]}),p=async()=>{b.value=!0;try{const e=await J({page:f.value,page_size:y.value});g.value=e.list,C.value=e.total}catch(e){console.error(e)}finally{b.value=!1}},D=()=>{m.value=!1,r.value={name:"",password:""},v.value=null,i.value=!0},M=e=>{m.value=!0,v.value=e.id,r.value={name:e.name,password:e.password},i.value=!0},I=async e=>{try{await de.confirm(d("common.delete_confirm",{name:g.value.find(a=>a.id===e)?.name||""}),d("common.confirm"),{type:"warning"}),await L(e),w.success(d("common.deleted")),p()}catch(a){a!=="cancel"&&console.error(a)}},P=async()=>{if(await k.value?.validate())try{const a={...r.value};m.value&&!a.password&&delete a.password,m.value&&v.value?(await G(v.value,a),w.success(d("common.save"))):(await H(a),w.success(d("common.created"))),i.value=!1,p()}catch(a){console.error(a)}},j=e=>{navigator.clipboard.writeText(e).then(()=>{w.success(d("common.copied"))})},q=()=>{const e="0123456789";let a="";for(let s=0;s<6;s++)a+=e.charAt(Math.floor(Math.random()*e.length));r.value.password=a},N=e=>{f.value=e,p()},T=e=>{y.value=e,f.value=1,p()};return W(()=>{p()}),(e,a)=>{const s=Z,$=se,_=ne,A=re,U=ce,E=te,S=le,F=oe,R=Y,x=ie;return z(),X("div",ue,[o($,{shadow:"hover"},{default:l(()=>[h("div",me,[o(s,{type:"success",onClick:D},{default:l(()=>[u(c(e.$t("common.new")),1)]),_:1})])]),_:1}),o($,{shadow:"never"},{default:l(()=>[ee((z(),ae(A,{data:g.value,stripe:"",size:"large",style:{width:"100%"}},{default:l(()=>[o(_,{prop:"id",label:"ID",width:"80"}),o(_,{label:e.$t("common.name"),prop:"name","min-width":"160"},null,8,["label"]),o(_,{label:e.$t("common.password"),prop:"password","min-width":"200"},{default:l(({row:t})=>[h("div",pe,[h("span",null,c(t.password),1),o(s,{type:"text",icon:"CopyDocument",onClick:V=>j(t.password),class:"ml-2"},null,8,["onClick"])])]),_:1},8,["label"]),o(_,{label:e.$t("common.actions"),width:"200",fixed:"right"},{default:l(({row:t})=>[o(s,{size:"small",onClick:V=>M(t)},{default:l(()=>[u(c(e.$t("common.edit")),1)]),_:2},1032,["onClick"]),o(s,{size:"small",type:"danger",onClick:V=>I(t.id)},{default:l(()=>[u(c(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[x,b.value]]),h("div",ve,[o(U,{background:"",layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],"page-size":y.value,"current-page":f.value,total:C.value,onCurrentChange:N,onSizeChange:T},null,8,["page-size","current-page","total"])])]),_:1}),o(R,{modelValue:i.value,"onUpdate:modelValue":a[3]||(a[3]=t=>i.value=t),title:m.value?e.$t("common.edit"):e.$t("common.create"),width:"520px"},{footer:l(()=>[o(s,{onClick:a[2]||(a[2]=t=>i.value=!1)},{default:l(()=>[u(c(e.$t("common.cancel")),1)]),_:1}),o(s,{type:"primary",onClick:P},{default:l(()=>[u(c(e.$t("common.confirm")),1)]),_:1})]),default:l(()=>[o(F,{ref_key:"formRef",ref:k,model:r.value,rules:B,"label-width":"140px"},{default:l(()=>[o(S,{label:e.$t("common.name"),prop:"name"},{default:l(()=>[o(E,{modelValue:r.value.name,"onUpdate:modelValue":a[0]||(a[0]=t=>r.value.name=t)},null,8,["modelValue"])]),_:1},8,["label"]),o(S,{label:e.$t("common.password"),prop:"password"},{default:l(()=>[o(E,{modelValue:r.value.password,"onUpdate:modelValue":a[1]||(a[1]=t=>r.value.password=t),"show-password":""},{append:l(()=>[o(s,{onClick:q},{default:l(()=>[u(c(e.$t("common.generate")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{be as default};
