import{a as Be,c as De,d as Le,u as Re,b as qe}from"./classes-B9YAiphQ.js";import{a as Ke}from"./schools-DEBpxMRk.js";import{ar as Ce,q as U,ao as le,s as Oe,ap as Q,aE as ue,aq as Ae,v as Ge,aF as je,aG as He,_ as Je,d as ye,B as We,C as Xe,r as I,ah as ie,az as Qe,c as R,aC as ne,aH as Ye,aI as Ze,H as xe,o as Fe,aJ as el,b as A,h as _,av as _e,f as $e,i as t,j as d,aK as oe,K as he,M as re,w as o,J as D,aL as ll,aM as al,O as ke,aN as sl,aO as tl,a8 as nl,N as Ve,aj as Me,aD as Ie,aP as ol,ac as rl,a2 as ul,ag as il,aQ as dl,ai as cl,e as H,F as J,g as W,ak as ml,k as y,t as V,al as pl,am as fl,an as X}from"./index-TzivwsyV.js";import{E as vl,f as bl,g as gl,b as hl,c as Vl,a as _l,e as yl,h as wl}from"./index-q58DMnPQ.js";import{v as Nl}from"./directive-C-1OC64t.js";const El=100,Cl=600,Se={beforeMount(c,N){const h=N.value,{interval:i=El,delay:z=Cl}=Ce(h)?{}:h;let g,w;const u=()=>Ce(h)?h():h.handler(),E=()=>{w&&(clearTimeout(w),w=void 0),g&&(clearInterval(g),g=void 0)};c.addEventListener("mousedown",p=>{p.button===0&&(E(),u(),document.addEventListener("mouseup",()=>E(),{once:!0}),w=setTimeout(()=>{g=setInterval(()=>{u()},i)},z))})}},$l=Oe({id:{type:String,default:void 0},step:{type:Number,default:1},stepStrictly:Boolean,max:{type:Number,default:Number.MAX_SAFE_INTEGER},min:{type:Number,default:Number.MIN_SAFE_INTEGER},modelValue:{type:[Number,null]},readonly:Boolean,disabled:Boolean,size:He,controls:{type:Boolean,default:!0},controlsPosition:{type:String,default:"",values:["","right"]},valueOnClear:{type:[String,Number,null],validator:c=>c===null||U(c)||["min","max"].includes(c),default:null},name:String,placeholder:String,precision:{type:Number,validator:c=>c>=0&&c===Number.parseInt(`${c}`,10)},validateEvent:{type:Boolean,default:!0},...je(["ariaLabel"]),inputmode:{type:Ge(String),default:void 0}}),kl={[Ae]:(c,N)=>N!==c,blur:c=>c instanceof FocusEvent,focus:c=>c instanceof FocusEvent,[ue]:c=>U(c)||le(c),[Q]:c=>U(c)||le(c)},Il=ye({name:"ElInputNumber"}),Sl=ye({...Il,props:$l,emits:kl,setup(c,{expose:N,emit:h}){const i=c,{t:z}=We(),g=Xe("input-number"),w=I(),u=ie({currentValue:i.modelValue,userInput:null}),{formItem:E}=Qe(),p=R(()=>U(i.modelValue)&&i.modelValue<=i.min),m=R(()=>U(i.modelValue)&&i.modelValue>=i.max),q=R(()=>{const e=G(i.step);return ne(i.precision)?Math.max(G(i.modelValue),e):(e>i.precision,i.precision)}),M=R(()=>i.controls&&i.controlsPosition==="right"),K=Ye(),B=Ze(),O=R(()=>{if(u.userInput!==null)return u.userInput;let e=u.currentValue;if(le(e))return"";if(U(e)){if(Number.isNaN(e))return"";ne(i.precision)||(e=e.toFixed(i.precision))}return e}),f=(e,n)=>{if(ne(n)&&(n=q.value),n===0)return Math.round(e);let r=String(e);const v=r.indexOf(".");if(v===-1||!r.replace(".","").split("")[v+n])return e;const j=r.length;return r.charAt(j-1)==="5"&&(r=`${r.slice(0,Math.max(0,j-1))}6`),Number.parseFloat(Number(r).toFixed(n))},G=e=>{if(le(e))return 0;const n=e.toString(),r=n.indexOf(".");let v=0;return r!==-1&&(v=n.length-r-1),v},ae=(e,n=1)=>U(e)?e>=Number.MAX_SAFE_INTEGER&&n===1||e<=Number.MIN_SAFE_INTEGER&&n===-1?e:f(e+i.step*n):u.currentValue,Y=()=>{if(i.readonly||B.value||m.value)return;const e=Number(O.value)||0,n=ae(e);$(n),h(ue,u.currentValue),x()},Z=()=>{if(i.readonly||B.value||p.value)return;const e=Number(O.value)||0,n=ae(e,-1);$(n),h(ue,u.currentValue),x()},se=(e,n)=>{const{max:r,min:v,step:b,precision:S,stepStrictly:j,valueOnClear:l}=i;r<v&&ol("InputNumber","min should not be greater than max.");let a=Number(e);if(le(e)||Number.isNaN(a))return null;if(e===""){if(l===null)return null;a=rl(l)?{min:v,max:r}[l]:l}return j&&(a=f(Math.round(a/b)*b,S),a!==e&&n&&h(Q,a)),ne(S)||(a=f(a,S)),(a>r||a<v)&&(a=a>r?r:v,n&&h(Q,a)),a},$=(e,n=!0)=>{var r;const v=u.currentValue,b=se(e);if(!n){h(Q,b);return}v===b&&e||(u.userInput=null,h(Q,b),v!==b&&h(Ae,b,v),i.validateEvent&&((r=E?.validate)==null||r.call(E,"change").catch(S=>Ie())),u.currentValue=b)},de=e=>{u.userInput=e;const n=e===""?null:Number(e);h(ue,n),$(n,!1)},ce=e=>{const n=e!==""?Number(e):"";(U(n)&&!Number.isNaN(n)||e==="")&&$(n),x(),u.userInput=null},me=()=>{var e,n;(n=(e=w.value)==null?void 0:e.focus)==null||n.call(e)},pe=()=>{var e,n;(n=(e=w.value)==null?void 0:e.blur)==null||n.call(e)},fe=e=>{h("focus",e)},ve=e=>{var n,r;u.userInput=null,u.currentValue===null&&((n=w.value)!=null&&n.input)&&(w.value.input.value=""),h("blur",e),i.validateEvent&&((r=E?.validate)==null||r.call(E,"blur").catch(v=>Ie()))},x=()=>{u.currentValue!==i.modelValue&&(u.currentValue=i.modelValue)},be=e=>{document.activeElement===e.target&&e.preventDefault()};return xe(()=>i.modelValue,(e,n)=>{const r=se(e,!0);u.userInput===null&&r!==n&&(u.currentValue=r)},{immediate:!0}),Fe(()=>{var e;const{min:n,max:r,modelValue:v}=i,b=(e=w.value)==null?void 0:e.input;if(b.setAttribute("role","spinbutton"),Number.isFinite(r)?b.setAttribute("aria-valuemax",String(r)):b.removeAttribute("aria-valuemax"),Number.isFinite(n)?b.setAttribute("aria-valuemin",String(n)):b.removeAttribute("aria-valuemin"),b.setAttribute("aria-valuenow",u.currentValue||u.currentValue===0?String(u.currentValue):""),b.setAttribute("aria-disabled",String(B.value)),!U(v)&&v!=null){let S=Number(v);Number.isNaN(S)&&(S=null),h(Q,S)}b.addEventListener("wheel",be,{passive:!1})}),el(()=>{var e,n;const r=(e=w.value)==null?void 0:e.input;r?.setAttribute("aria-valuenow",`${(n=u.currentValue)!=null?n:""}`)}),N({focus:me,blur:pe}),(e,n)=>(_(),A("div",{class:he([d(g).b(),d(g).m(d(K)),d(g).is("disabled",d(B)),d(g).is("without-controls",!e.controls),d(g).is("controls-right",d(M))]),onDragstart:Ve(()=>{},["prevent"])},[e.controls?_e((_(),A("span",{key:0,role:"button","aria-label":d(z)("el.inputNumber.decrease"),class:he([d(g).e("decrease"),d(g).is("disabled",d(p))]),onKeydown:oe(Z,["enter"])},[re(e.$slots,"decrease-icon",{},()=>[t(d(ke),null,{default:o(()=>[d(M)?(_(),D(d(ll),{key:0})):(_(),D(d(al),{key:1}))]),_:1})])],42,["aria-label","onKeydown"])),[[d(Se),Z]]):$e("v-if",!0),e.controls?_e((_(),A("span",{key:1,role:"button","aria-label":d(z)("el.inputNumber.increase"),class:he([d(g).e("increase"),d(g).is("disabled",d(m))]),onKeydown:oe(Y,["enter"])},[re(e.$slots,"increase-icon",{},()=>[t(d(ke),null,{default:o(()=>[d(M)?(_(),D(d(sl),{key:0})):(_(),D(d(tl),{key:1}))]),_:1})])],42,["aria-label","onKeydown"])),[[d(Se),Y]]):$e("v-if",!0),t(d(Me),{id:e.id,ref_key:"input",ref:w,type:"number",step:e.step,"model-value":d(O),placeholder:e.placeholder,readonly:e.readonly,disabled:d(B),size:d(K),max:e.max,min:e.min,name:e.name,"aria-label":e.ariaLabel,"validate-event":!1,inputmode:e.inputmode,onKeydown:[oe(Ve(Y,["prevent"]),["up"]),oe(Ve(Z,["prevent"]),["down"])],onBlur:ve,onFocus:fe,onInput:de,onChange:ce},nl({_:2},[e.$slots.prefix?{name:"prefix",fn:o(()=>[re(e.$slots,"prefix")])}:void 0,e.$slots.suffix?{name:"suffix",fn:o(()=>[re(e.$slots,"suffix")])}:void 0]),1032,["id","step","model-value","placeholder","readonly","disabled","size","max","min","name","aria-label","inputmode","onKeydown"])],42,["onDragstart"]))}});var Al=Je(Sl,[["__file","input-number.vue"]]);const Fl=ul(Al),Ml={class:"space-y-4"},Pl={class:"flex items-center justify-start gap-2"},Tl={class:"flex items-center"},Ul={class:"flex justify-end mt-4"},zl={class:"flex items-center w-full"},Bl={class:"mr-4 text-gray-500 flex-shrink-0"},Ol=ye({__name:"ClassAdminView",setup(c){const{t:N}=il(),{copy:h,copied:i}=dl(),z=I([]),g=I([]),w=I(!0),u=I(!1),E=I(!1),p=ie({name:"",school_id:void 0,grade:void 0,status:void 0}),m=I({}),q=I(null),M=I(1),K=I(20),B=I(0),O=I(),f=ie({visible:!1,schoolId:void 0,grades:[{grade:1,classCount:4}]}),G=[{label:"已放学",value:0},{label:"上课中",value:1},{label:"放学中",value:2}],ae=ie({name:[{required:!0,message:"Name is required",trigger:"blur"}],school_id:[{required:!0,message:"School is required",trigger:"change"}],class:[{required:!0,message:"Class is required",trigger:"blur"}]}),Y=R(()=>g.value.reduce((l,a)=>(l[a.id]=a.name,l),{})),Z=R(()=>G.reduce((l,a)=>(l[a.value]=a.label,l),{})),se={0:"info",1:"success",2:"warning"},$=async()=>{w.value=!0;try{const l=await Be({page:M.value,page_size:K.value,school_id:p.school_id,grade:p.grade,name:p.name,status:p.status});z.value=l.list,B.value=l.total}catch(l){console.error(l)}finally{w.value=!1}},de=async()=>{try{const l=await Ke({page_size:1e3});g.value=l.list}catch(l){console.error(l)}},ce=()=>{E.value=!1,m.value={name:"",grade:void 0,class:void 0,school_id:void 0,status:0,password:""},q.value=null,u.value=!0},me=()=>{p.name="",p.school_id=void 0,p.grade=void 0,p.status=void 0,M.value=1,$()},pe=()=>{f.grades=[{grade:1,classCount:4}],f.schoolId=void 0,f.visible=!0},fe=()=>{f.grades.push({grade:f.grades.length+1,classCount:4})},ve=l=>{f.grades.splice(l,1)},x=async()=>{if(!f.schoolId){X.error(N("classes.please_select_school"));return}const l=[];for(let a=1;a<=f.grades.length;a++){const k=f.grades[a-1];for(let F=1;F<=k.classCount;F++)l.push({school_id:f.schoolId,grade:k.grade,class:F,name:`${k.grade}年级${F}班`,password:n()})}try{await De({classes:l}),X.success(N("common.created")),f.visible=!1,$()}catch(a){console.error(a)}},be=l=>{E.value=!0,q.value=l.id,m.value={...l},u.value=!0},e=()=>{const l=n();m.value&&(m.value.password=l)},n=()=>{const l="0123456789";let a="";for(let k=0;k<6;k++)a+=l.charAt(Math.floor(Math.random()*l.length));return a},r=l=>{h(l),i.value&&X.success(N("common.copied"))},v=async l=>{try{await wl.confirm(N("common.delete_confirm",{name:z.value.find(a=>a.id===l)?.name||""}),N("common.confirm"),{type:"warning"}),await Le(l),X.success(N("common.deleted")),$()}catch(a){a!=="cancel"&&console.error(a)}},b=async()=>{if(await O.value?.validate())try{E.value&&q.value?(await Re(q.value,m.value),X.success(N("common.save"))):(await qe(m.value),X.success(N("common.created"))),u.value=!1,$()}catch(a){console.error(a)}},S=l=>{M.value=l,$()},j=l=>{K.value=l,M.value=1,$()};return Fe(()=>{$(),de()}),(l,a)=>{const k=gl,F=bl,ee=Fl,ge=Me,C=ml,we=vl,P=hl,Pe=Vl,Te=_l,Ue=yl,T=fl,Ne=pl,Ee=cl,ze=Nl;return _(),A("div",Ml,[t(we,{shadow:"hover"},{default:o(()=>[H("div",Pl,[t(F,{modelValue:p.school_id,"onUpdate:modelValue":a[0]||(a[0]=s=>p.school_id=s),placeholder:l.$t("schools.school"),clearable:"",class:"w-48"},{default:o(()=>[(_(!0),A(J,null,W(g.value,s=>(_(),D(k,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),t(ee,{modelValue:p.grade,"onUpdate:modelValue":a[1]||(a[1]=s=>p.grade=s),placeholder:l.$t("classes.grade"),clearable:"",class:"w-48"},null,8,["modelValue","placeholder"]),t(F,{modelValue:p.status,"onUpdate:modelValue":a[2]||(a[2]=s=>p.status=s),placeholder:l.$t("common.status"),clearable:"",class:"w-48"},{default:o(()=>[(_(),A(J,null,W(G,s=>t(k,{key:s.value,label:s.label,value:s.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"]),t(ge,{modelValue:p.name,"onUpdate:modelValue":a[3]||(a[3]=s=>p.name=s),placeholder:l.$t("common.search_by_name"),clearable:"",class:"w-48"},null,8,["modelValue","placeholder"]),t(C,{type:"primary",onClick:$},{default:o(()=>[y(V(l.$t("common.search")),1)]),_:1}),t(C,{onClick:me},{default:o(()=>[y(V(l.$t("common.reset")),1)]),_:1}),t(C,{type:"primary",onClick:pe},{default:o(()=>[y(V(l.$t("classes.bulk_add")),1)]),_:1}),t(C,{type:"success",onClick:ce},{default:o(()=>[y(V(l.$t("common.new")),1)]),_:1})])]),_:1}),t(we,{shadow:"never"},{default:o(()=>[_e((_(),D(Te,{data:z.value,stripe:"",size:"large",style:{width:"100%"}},{default:o(()=>[t(P,{prop:"id",label:"ID",width:"80"}),t(P,{label:l.$t("common.name"),prop:"name","min-width":"160"},null,8,["label"]),t(P,{label:l.$t("schools.school"),"min-width":"160"},{default:o(({row:s})=>[y(V(Y.value[s.school_id]),1)]),_:1},8,["label"]),t(P,{label:l.$t("classes.grade"),prop:"grade",width:"100"},null,8,["label"]),t(P,{label:l.$t("classes.class"),prop:"class",width:"100"},null,8,["label"]),t(P,{label:l.$t("common.status"),prop:"status",width:"120"},{default:o(({row:s})=>[t(Pe,{type:se[s.status]},{default:o(()=>[y(V(Z.value[s.status]),1)]),_:2},1032,["type"])]),_:1},8,["label"]),t(P,{label:l.$t("classes.teachers"),"min-width":"150"},{default:o(({row:s})=>[y(V(s.teacher_infos.map(L=>L.user_name).join(", ")),1)]),_:1},8,["label"]),t(P,{label:l.$t("classes.password"),prop:"password","min-width":"150"},{default:o(({row:s})=>[H("div",Tl,[H("span",null,V(s.password),1),t(C,{link:"",type:"primary",onClick:L=>r(s.password),class:"ml-2"},{default:o(()=>[y(V(l.$t("common.copy")),1)]),_:2},1032,["onClick"])])]),_:1},8,["label"]),t(P,{label:l.$t("common.actions"),width:"200",fixed:"right"},{default:o(({row:s})=>[t(C,{size:"small",onClick:L=>be(s)},{default:o(()=>[y(V(l.$t("common.edit")),1)]),_:2},1032,["onClick"]),t(C,{size:"small",type:"danger",onClick:L=>v(s.id)},{default:o(()=>[y(V(l.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[ze,w.value]]),H("div",Ul,[t(Ue,{background:"",layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],"page-size":K.value,"current-page":M.value,total:B.value,onCurrentChange:S,onSizeChange:j},null,8,["page-size","current-page","total"])])]),_:1}),t(Ee,{modelValue:u.value,"onUpdate:modelValue":a[11]||(a[11]=s=>u.value=s),title:E.value?l.$t("common.edit"):l.$t("common.create"),width:"520px"},{footer:o(()=>[t(C,{onClick:a[10]||(a[10]=s=>u.value=!1)},{default:o(()=>[y(V(l.$t("common.cancel")),1)]),_:1}),t(C,{type:"primary",onClick:b},{default:o(()=>[y(V(l.$t("common.confirm")),1)]),_:1})]),default:o(()=>[t(Ne,{ref_key:"formRef",ref:O,model:m.value,rules:ae,"label-width":"140px"},{default:o(()=>[t(T,{label:l.$t("common.name"),prop:"name"},{default:o(()=>[t(ge,{modelValue:m.value.name,"onUpdate:modelValue":a[4]||(a[4]=s=>m.value.name=s)},null,8,["modelValue"])]),_:1},8,["label"]),t(T,{label:l.$t("schools.school"),prop:"school_id"},{default:o(()=>[t(F,{modelValue:m.value.school_id,"onUpdate:modelValue":a[5]||(a[5]=s=>m.value.school_id=s),class:"w-full"},{default:o(()=>[(_(!0),A(J,null,W(g.value,s=>(_(),D(k,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(T,{label:l.$t("classes.grade"),prop:"grade"},{default:o(()=>[t(ee,{modelValue:m.value.grade,"onUpdate:modelValue":a[6]||(a[6]=s=>m.value.grade=s),min:1},null,8,["modelValue"])]),_:1},8,["label"]),t(T,{label:l.$t("classes.class"),prop:"class"},{default:o(()=>[t(ee,{modelValue:m.value.class,"onUpdate:modelValue":a[7]||(a[7]=s=>m.value.class=s),min:1},null,8,["modelValue"])]),_:1},8,["label"]),t(T,{label:l.$t("common.status"),prop:"status"},{default:o(()=>[t(F,{modelValue:m.value.status,"onUpdate:modelValue":a[8]||(a[8]=s=>m.value.status=s),class:"w-full"},{default:o(()=>[(_(),A(J,null,W(G,s=>t(k,{key:s.value,label:s.label,value:s.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(T,{label:l.$t("classes.password"),prop:"password"},{default:o(()=>[t(ge,{modelValue:m.value.password,"onUpdate:modelValue":a[9]||(a[9]=s=>m.value.password=s),type:"password","show-password":""},{append:o(()=>[t(C,{onClick:e},{default:o(()=>[y(V(l.$t("common.generate")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(Ee,{modelValue:f.visible,"onUpdate:modelValue":a[14]||(a[14]=s=>f.visible=s),title:l.$t("classes.bulk_add"),width:"720px"},{footer:o(()=>[t(C,{onClick:a[13]||(a[13]=s=>f.visible=!1)},{default:o(()=>[y(V(l.$t("common.cancel")),1)]),_:1}),t(C,{type:"primary",onClick:x},{default:o(()=>[y(V(l.$t("common.confirm")),1)]),_:1})]),default:o(()=>[t(Ne,{"label-width":"140px"},{default:o(()=>[t(T,{label:l.$t("schools.school"),required:""},{default:o(()=>[t(F,{modelValue:f.schoolId,"onUpdate:modelValue":a[12]||(a[12]=s=>f.schoolId=s),class:"w-full"},{default:o(()=>[(_(!0),A(J,null,W(g.value,s=>(_(),D(k,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),(_(!0),A(J,null,W(f.grades,(s,L)=>(_(),A("div",{key:L,class:"bg-slate-50 p-4 rounded-md mb-4"},[t(T,{label:`${l.$t("classes.grade")} `},{default:o(()=>[H("div",zl,[t(ee,{modelValue:s.grade,"onUpdate:modelValue":te=>s.grade=te,min:1,class:"mr-auto"},null,8,["modelValue","onUpdate:modelValue"]),H("span",Bl,V(l.$t("classes.class_count")),1),t(ee,{modelValue:s.classCount,"onUpdate:modelValue":te=>s.classCount=te,min:1,class:"mr-auto"},null,8,["modelValue","onUpdate:modelValue"]),t(C,{type:"danger",onClick:te=>ve(L)},{default:o(()=>[y(V(l.$t("common.delete")),1)]),_:2},1032,["onClick"])])]),_:2},1032,["label"])]))),128)),t(T,{label:" "},{default:o(()=>[t(C,{onClick:fe},{default:o(()=>[y(V(l.$t("classes.add_grade")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}});export{Ol as default};
