import{g as K,c as Q,u as W,d as X}from"./permissions-BDVdrrlC.js";import{d as Y,r as v,ag as Z,ah as V,o as x,b as z,i as a,w as t,ai as ee,e as I,aj as ae,ak as oe,k as u,t as c,al as le,am as ne,F as te,g as se,J as ie,j as re,an as w,h as C}from"./index-TzivwsyV.js";import{E as de,a as me,b as ue,e as ce,f as pe,g as fe,h as ge}from"./index-q58DMnPQ.js";var U=(p=>(p.READ="read",p.CREATE="create",p.UPDATE="update",p.DELETE="delete",p))(U||{});const ve={class:"space-y-4"},be={class:"flex items-center gap-2"},_e={class:"flex justify-end mt-4"},Ee=Y({__name:"PermissionAdminView",setup(p){const $=v([]),P=v([]),b=v(1),E=v(20),h=v(0),{t:f}=Z(),i=V({name:"",resource:"",action:""});async function r(){const e=await K({page:b.value,page_size:E.value,name:i.name||void 0,resource:i.resource||void 0,action:i.action||void 0});$.value=e.list,h.value=e.total}function q(){i.name="",i.resource="",i.action="",b.value=1,r()}function S(e){P.value=e.map(l=>l.id)}function B(e){b.value=e,r()}function D(e){E.value=e,b.value=1,r()}const s=V({visible:!1,mode:"create",editingId:void 0}),k=v(),n=V({name:"",resource:"",action:"",description:""}),j=V({name:[{required:!0,message:"Name required"}],resource:[{required:!0,message:"Resource required"}],action:[{required:!0,message:"Action required"}]});function F(){s.mode="create",s.editingId=void 0,n.name="",n.resource="",n.action="",n.description="",s.visible=!0}function R(e){s.mode="edit",s.editingId=e.id,n.name=e.name,n.resource=e.resource,n.action=e.action,n.description=e.description,s.visible=!0}async function N(){if(!await k.value?.validate()){w.error(f("common.please_check_form"));return}s.mode==="create"?(await Q(n),w.success(f("common.created"))):s.editingId!=null&&(await W(s.editingId,n),w.success(f("common.save"))),s.visible=!1,await r()}async function M(e){await ge.confirm(f("common.delete_confirm",{name:$.value.find(l=>l.id===e)?.name||""}),f("common.confirm"),{type:"warning"}),await X(e),w.success(f("common.deleted")),r()}return x(r),(e,l)=>{const g=ae,d=oe,y=de,m=ue,T=me,A=ce,_=ne,L=fe,O=pe,J=le,G=ee;return C(),z("div",ve,[a(y,{shadow:"hover"},{default:t(()=>[I("div",be,[a(g,{modelValue:i.name,"onUpdate:modelValue":l[0]||(l[0]=o=>i.name=o),placeholder:e.$t("common.search_by_name"),clearable:"",class:"w-48"},null,8,["modelValue","placeholder"]),a(g,{modelValue:i.resource,"onUpdate:modelValue":l[1]||(l[1]=o=>i.resource=o),placeholder:e.$t("permissions.resource"),clearable:"",class:"w-48"},null,8,["modelValue","placeholder"]),a(g,{modelValue:i.action,"onUpdate:modelValue":l[2]||(l[2]=o=>i.action=o),placeholder:e.$t("permissions.action"),clearable:"",class:"w-48"},null,8,["modelValue","placeholder"]),a(d,{type:"primary",onClick:r},{default:t(()=>[u(c(e.$t("common.search")),1)]),_:1}),a(d,{onClick:q},{default:t(()=>[u(c(e.$t("common.reset")),1)]),_:1}),a(d,{type:"success",onClick:F},{default:t(()=>[u(c(e.$t("common.new")),1)]),_:1})])]),_:1}),a(y,{shadow:"never"},{default:t(()=>[a(T,{data:$.value,stripe:"",size:"large",style:{width:"100%"},onSelectionChange:S},{default:t(()=>[a(m,{type:"selection",width:"50"}),a(m,{prop:"id",label:"ID",width:"80"}),a(m,{label:e.$t("common.name"),prop:"name","min-width":"160"},null,8,["label"]),a(m,{label:e.$t("permissions.resource"),prop:"resource","min-width":"200"},null,8,["label"]),a(m,{label:e.$t("permissions.action"),prop:"action","min-width":"120"},null,8,["label"]),a(m,{label:e.$t("common.description"),prop:"description","min-width":"200"},null,8,["label"]),a(m,{label:e.$t("common.actions"),width:"200",fixed:"right"},{default:t(({row:o})=>[a(d,{size:"small",onClick:H=>R(o)},{default:t(()=>[u(c(e.$t("common.edit")),1)]),_:2},1032,["onClick"]),a(d,{size:"small",type:"danger",onClick:H=>M(o.id)},{default:t(()=>[u(c(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"]),I("div",_e,[a(A,{background:"",layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],"page-size":E.value,"current-page":b.value,total:h.value,onCurrentChange:B,onSizeChange:D},null,8,["page-size","current-page","total"])])]),_:1}),a(G,{modelValue:s.visible,"onUpdate:modelValue":l[8]||(l[8]=o=>s.visible=o),title:s.mode==="create"?e.$t("common.create"):e.$t("common.edit"),width:"520px"},{footer:t(()=>[a(d,{onClick:l[7]||(l[7]=o=>s.visible=!1)},{default:t(()=>[u(c(e.$t("common.cancel")),1)]),_:1}),a(d,{type:"primary",onClick:N},{default:t(()=>[u(c(e.$t("common.confirm")),1)]),_:1})]),default:t(()=>[a(J,{"label-width":"140px",ref_key:"formRef",ref:k,model:n,rules:j},{default:t(()=>[a(_,{label:e.$t("common.name"),prop:"name"},{default:t(()=>[a(g,{modelValue:n.name,"onUpdate:modelValue":l[3]||(l[3]=o=>n.name=o)},null,8,["modelValue"])]),_:1},8,["label"]),a(_,{label:e.$t("permissions.resource"),prop:"resource"},{default:t(()=>[a(g,{modelValue:n.resource,"onUpdate:modelValue":l[4]||(l[4]=o=>n.resource=o)},null,8,["modelValue"])]),_:1},8,["label"]),a(_,{label:e.$t("permissions.action"),prop:"action"},{default:t(()=>[a(O,{modelValue:n.action,"onUpdate:modelValue":l[5]||(l[5]=o=>n.action=o),class:"w-full"},{default:t(()=>[(C(!0),z(te,null,se(Object.values(re(U)),o=>(C(),ie(L,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(_,{label:e.$t("common.description"),prop:"description"},{default:t(()=>[a(g,{modelValue:n.description,"onUpdate:modelValue":l[6]||(l[6]=o=>n.description=o),type:"textarea"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{Ee as default};
