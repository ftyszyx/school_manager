import{g as De,c as Pe,u as Ae,d as Be}from"./roles-g8JascAK.js";import{g as Ne}from"./permissions-BDVdrrlC.js";import{a6 as X,ao as Ue,s as me,ap as he,aq as pe,x as Ie,v as D,c as _,ar as Me,H as S,_ as ge,d as G,as as ke,B as ve,C as Ce,ah as j,at as z,au as Re,b as F,h as U,e as I,f as Y,i as o,w as d,k as P,t as E,j as a,K as w,J as se,av as oe,aw as ze,aj as ye,ax as re,F as Fe,g as Le,M as H,ay as ee,az as qe,r as N,aA as ie,aB as Oe,O as de,Q as je,aC as ce,ak as ae,S as He,aD as Se,a2 as Ge,ag as Ke,o as Qe,ai as Je,al as We,am as Xe,an as W}from"./index-TzivwsyV.js";import{i as ue,j as Ye,E as Ze,a as xe,b as ea,e as aa,h as ta}from"./index-q58DMnPQ.js";const be="left-check-change",_e="right-check-change",O=me({data:{type:D(Array),default:()=>[]},titles:{type:D(Array),default:()=>[]},buttonTexts:{type:D(Array),default:()=>[]},filterPlaceholder:String,filterMethod:{type:D(Function)},leftDefaultChecked:{type:D(Array),default:()=>[]},rightDefaultChecked:{type:D(Array),default:()=>[]},renderContent:{type:D(Function)},modelValue:{type:D(Array),default:()=>[]},format:{type:D(Object),default:()=>({})},filterable:Boolean,props:{type:D(Object),default:()=>Ie({label:"label",key:"key",disabled:"disabled"})},targetOrder:{type:String,values:["original","push","unshift"],default:"original"},validateEvent:{type:Boolean,default:!0}}),te=(t,l)=>[t,l].every(X)||X(t)&&Ue(l),la={[pe]:(t,l,C)=>[t,C].every(X)&&["left","right"].includes(l),[he]:t=>X(t),[be]:te,[_e]:te},le="checked-change",na=me({data:O.data,optionRender:{type:D(Function)},placeholder:String,title:String,filterable:Boolean,format:O.format,filterMethod:O.filterMethod,defaultChecked:O.leftDefaultChecked,props:O.props}),sa={[le]:te},K=t=>{const l={label:"label",key:"key",disabled:"disabled"};return _(()=>({...l,...t.props}))},oa=(t,l,C)=>{const r=K(t),f=_(()=>t.data.filter(s=>Me(t.filterMethod)?t.filterMethod(l.query,s):String(s[r.value.label]||s[r.value.key]).toLowerCase().includes(l.query.toLowerCase()))),i=_(()=>f.value.filter(s=>!s[r.value.disabled])),g=_(()=>{const s=l.checked.length,m=t.data.length,{noChecked:y,hasChecked:T}=t.format;return y&&T?s>0?T.replace(/\${checked}/g,s.toString()).replace(/\${total}/g,m.toString()):y.replace(/\${total}/g,m.toString()):`${s}/${m}`}),n=_(()=>{const s=l.checked.length;return s>0&&s<i.value.length}),h=()=>{const s=i.value.map(m=>m[r.value.key]);l.allChecked=s.length>0&&s.every(m=>l.checked.includes(m))},c=s=>{l.checked=s?i.value.map(m=>m[r.value.key]):[]};return S(()=>l.checked,(s,m)=>{if(h(),l.checkChangeByUser){const y=s.concat(m).filter(T=>!s.includes(T)||!m.includes(T));C(le,s,y)}else C(le,s),l.checkChangeByUser=!0}),S(i,()=>{h()}),S(()=>t.data,()=>{const s=[],m=f.value.map(y=>y[r.value.key]);l.checked.forEach(y=>{m.includes(y)&&s.push(y)}),l.checkChangeByUser=!1,l.checked=s}),S(()=>t.defaultChecked,(s,m)=>{if(m&&s.length===m.length&&s.every(V=>m.includes(V)))return;const y=[],T=i.value.map(V=>V[r.value.key]);s.forEach(V=>{T.includes(V)&&y.push(V)}),l.checkChangeByUser=!1,l.checked=y},{immediate:!0}),{filteredData:f,checkableData:i,checkedSummary:g,isIndeterminate:n,updateAllChecked:h,handleAllCheckedChange:c}},ra=G({name:"ElTransferPanel"}),ia=G({...ra,props:na,emits:sa,setup(t,{expose:l,emit:C}){const r=t,f=ke(),i=({option:b})=>b,{t:g}=ve(),n=Ce("transfer"),h=j({checked:[],allChecked:!1,query:"",checkChangeByUser:!0}),c=K(r),{filteredData:s,checkedSummary:m,isIndeterminate:y,handleAllCheckedChange:T}=oa(r,h,C),V=_(()=>!z(h.query)&&z(s.value)),k=_(()=>!z(f.default()[0].children)),{checked:A,allChecked:p,query:M}=Re(h);return l({query:M}),(b,Q)=>(U(),F("div",{class:w(a(n).b("panel"))},[I("p",{class:w(a(n).be("panel","header"))},[o(a(ue),{modelValue:a(p),"onUpdate:modelValue":$=>ee(p)?p.value=$:null,indeterminate:a(y),"validate-event":!1,onChange:a(T)},{default:d(()=>[P(E(b.title)+" ",1),I("span",null,E(a(m)),1)]),_:1},8,["modelValue","onUpdate:modelValue","indeterminate","onChange"])],2),I("div",{class:w([a(n).be("panel","body"),a(n).is("with-footer",a(k))])},[b.filterable?(U(),se(a(ye),{key:0,modelValue:a(M),"onUpdate:modelValue":$=>ee(M)?M.value=$:null,class:w(a(n).be("panel","filter")),size:"default",placeholder:b.placeholder,"prefix-icon":a(ze),clearable:"","validate-event":!1},null,8,["modelValue","onUpdate:modelValue","class","placeholder","prefix-icon"])):Y("v-if",!0),oe(o(a(Ye),{modelValue:a(A),"onUpdate:modelValue":$=>ee(A)?A.value=$:null,"validate-event":!1,class:w([a(n).is("filterable",b.filterable),a(n).be("panel","list")])},{default:d(()=>[(U(!0),F(Fe,null,Le(a(s),$=>(U(),se(a(ue),{key:$[a(c).key],class:w(a(n).be("panel","item")),value:$[a(c).key],disabled:$[a(c).disabled],"validate-event":!1},{default:d(()=>{var R;return[o(i,{option:(R=b.optionRender)==null?void 0:R.call(b,$)},null,8,["option"])]}),_:2},1032,["class","value","disabled"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","class"]),[[re,!a(V)&&!a(z)(b.data)]]),oe(I("div",{class:w(a(n).be("panel","empty"))},[H(b.$slots,"empty",{},()=>[P(E(a(V)?a(g)("el.transfer.noMatch"):a(g)("el.transfer.noData")),1)])],2),[[re,a(V)||a(z)(b.data)]])],2),a(k)?(U(),F("p",{key:0,class:w(a(n).be("panel","footer"))},[H(b.$slots,"default")],2)):Y("v-if",!0)],2))}});var fe=ge(ia,[["__file","transfer-panel.vue"]]);const da=t=>{const l=K(t),C=_(()=>t.data.reduce((i,g)=>(i[g[l.value.key]]=g)&&i,{})),r=_(()=>t.data.filter(i=>!t.modelValue.includes(i[l.value.key]))),f=_(()=>t.targetOrder==="original"?t.data.filter(i=>t.modelValue.includes(i[l.value.key])):t.modelValue.reduce((i,g)=>{const n=C.value[g];return n&&i.push(n),i},[]));return{sourceData:r,targetData:f}},ca=(t,l,C)=>{const r=K(t),f=(n,h,c)=>{C(he,n),C(pe,n,h,c)};return{addToLeft:()=>{const n=t.modelValue.slice();l.rightChecked.forEach(h=>{const c=n.indexOf(h);c>-1&&n.splice(c,1)}),f(n,"left",l.rightChecked)},addToRight:()=>{let n=t.modelValue.slice();const h=t.data.filter(c=>{const s=c[r.value.key];return l.leftChecked.includes(s)&&!t.modelValue.includes(s)}).map(c=>c[r.value.key]);n=t.targetOrder==="unshift"?h.concat(n):n.concat(h),t.targetOrder==="original"&&(n=t.data.filter(c=>n.includes(c[r.value.key])).map(c=>c[r.value.key])),f(n,"right",l.leftChecked)}}},ua=(t,l)=>({onSourceCheckedChange:(f,i)=>{t.leftChecked=f,i&&l(be,f,i)},onTargetCheckedChange:(f,i)=>{t.rightChecked=f,i&&l(_e,f,i)}}),fa=G({name:"ElTransfer"}),ma=G({...fa,props:O,emits:la,setup(t,{expose:l,emit:C}){const r=t,f=ke(),{t:i}=ve(),g=Ce("transfer"),{formItem:n}=qe(),h=j({leftChecked:[],rightChecked:[]}),c=K(r),{sourceData:s,targetData:m}=da(r),{onSourceCheckedChange:y,onTargetCheckedChange:T}=ua(h,C),{addToLeft:V,addToRight:k}=ca(r,h,C),A=N(),p=N(),M=e=>{switch(e){case"left":A.value.query="";break;case"right":p.value.query="";break}},b=_(()=>r.buttonTexts.length===2),Q=_(()=>r.titles[0]||i("el.transfer.titles.0")),$=_(()=>r.titles[1]||i("el.transfer.titles.1")),R=_(()=>r.filterPlaceholder||i("el.transfer.filterPlaceholder"));S(()=>r.modelValue,()=>{var e;r.validateEvent&&((e=n?.validate)==null||e.call(n,"change").catch(u=>Se()))});const J=_(()=>e=>{var u;if(r.renderContent)return r.renderContent(ie,e);const L=(((u=f.default)==null?void 0:u.call(f,{option:e}))||[]).filter(B=>B.type!==Oe);return L.length?L:ie("span",e[c.value.label]||e[c.value.key])});return l({clearQuery:M,leftPanel:A,rightPanel:p}),(e,u)=>(U(),F("div",{class:w(a(g).b())},[o(fe,{ref_key:"leftPanel",ref:A,data:a(s),"option-render":a(J),placeholder:a(R),title:a(Q),filterable:e.filterable,format:e.format,"filter-method":e.filterMethod,"default-checked":e.leftDefaultChecked,props:r.props,onCheckedChange:a(y)},{empty:d(()=>[H(e.$slots,"left-empty")]),default:d(()=>[H(e.$slots,"left-footer")]),_:3},8,["data","option-render","placeholder","title","filterable","format","filter-method","default-checked","props","onCheckedChange"]),I("div",{class:w(a(g).e("buttons"))},[o(a(ae),{type:"primary",class:w([a(g).e("button"),a(g).is("with-texts",a(b))]),disabled:a(z)(h.rightChecked),onClick:a(V)},{default:d(()=>[o(a(de),null,{default:d(()=>[o(a(je))]),_:1}),a(ce)(e.buttonTexts[0])?Y("v-if",!0):(U(),F("span",{key:0},E(e.buttonTexts[0]),1))]),_:1},8,["class","disabled","onClick"]),o(a(ae),{type:"primary",class:w([a(g).e("button"),a(g).is("with-texts",a(b))]),disabled:a(z)(h.leftChecked),onClick:a(k)},{default:d(()=>[a(ce)(e.buttonTexts[1])?Y("v-if",!0):(U(),F("span",{key:0},E(e.buttonTexts[1]),1)),o(a(de),null,{default:d(()=>[o(a(He))]),_:1})]),_:1},8,["class","disabled","onClick"])],2),o(fe,{ref_key:"rightPanel",ref:p,data:a(m),"option-render":a(J),placeholder:a(R),filterable:e.filterable,format:e.format,"filter-method":e.filterMethod,title:a($),"default-checked":e.rightDefaultChecked,props:r.props,onCheckedChange:a(T)},{empty:d(()=>[H(e.$slots,"right-empty")]),default:d(()=>[H(e.$slots,"right-footer")]),_:3},8,["data","option-render","placeholder","filterable","format","filter-method","title","default-checked","props","onCheckedChange"])],2))}});var ha=ge(ma,[["__file","transfer.vue"]]);const pa=Ge(ha),ga={class:"space-y-4"},ka={class:"flex items-center gap-2"},va={class:"flex items-center gap-2"},Ca={class:"text-gray-800 break-all"},ya={class:"flex justify-end mt-4"},$a=G({__name:"RoleAdminView",setup(t){const l=N([]),C=N([]),r=N([]),f=N(1),i=N(20),g=N(0),{t:n}=Ke(),h=j({name:""});async function c(){const e=await De({page:f.value,page_size:i.value,name:h.name||void 0});l.value=e.list,g.value=e.total}async function s(){const e=await Ne({page:1,page_size:1e3});C.value=e.list}function m(){h.name="",f.value=1,c()}function y(e){r.value=e.map(u=>u.id)}function T(e){f.value=e,c()}function V(e){i.value=e,f.value=1,c()}const k=j({visible:!1,mode:"create",editingId:void 0}),A=N(),p=j({name:"",description:"",permission_ids:[]}),M=j({name:[{required:!0,message:"Name required"}]}),b=_(()=>C.value.map(e=>({key:e.id,label:`${e.name} (${e.resource}:${e.action})`,disabled:!1})));function Q(){k.mode="create",k.editingId=void 0,p.name="",p.description="",p.permission_ids=[],k.visible=!0}function $(e){k.mode="edit",k.editingId=e.id,p.name=e.name,p.description=e.description||"",p.permission_ids=e.permission_infos?.map(u=>u.id)||[],k.visible=!0}async function R(){if(!await A.value?.validate()){W.error(n("common.please_check_form"));return}const u={name:p.name,description:p.description||void 0,permission_ids:p.permission_ids};k.mode==="create"?(await Pe(u),W.success(n("common.created"))):k.editingId!=null&&(await Ae(k.editingId,u),W.success(n("common.save"))),k.visible=!1,await c()}async function J(e){await ta.confirm(n("common.delete_confirm",{name:l.value.find(u=>u.id===e)?.name||""}),n("common.confirm"),{type:"warning"}),await Be(e),W.success(n("common.deleted")),c()}return Qe(()=>{c(),s()}),(e,u)=>{const L=ye,B=ae,ne=Ze,q=ea,Ee=xe,Ve=aa,Z=Xe,$e=pa,Te=We,we=Je;return U(),F("div",ga,[o(ne,{shadow:"hover"},{default:d(()=>[I("div",ka,[o(L,{modelValue:h.name,"onUpdate:modelValue":u[0]||(u[0]=v=>h.name=v),placeholder:e.$t("common.search_by_name"),clearable:"",class:"w-64"},null,8,["modelValue","placeholder"]),o(B,{type:"primary",onClick:c},{default:d(()=>[P(E(e.$t("common.search")),1)]),_:1}),o(B,{onClick:m},{default:d(()=>[P(E(e.$t("common.reset")),1)]),_:1}),o(B,{type:"success",onClick:Q},{default:d(()=>[P(E(e.$t("common.new")),1)]),_:1})])]),_:1}),o(ne,{shadow:"never"},{default:d(()=>[o(Ee,{data:l.value,stripe:"",size:"large",style:{width:"100%"},onSelectionChange:y},{default:d(()=>[o(q,{type:"selection",width:"50"}),o(q,{prop:"id",label:"ID",width:"80"}),o(q,{label:e.$t("common.name"),"min-width":"160"},{default:d(({row:v})=>[I("div",va,[I("span",Ca,E(v.name),1)])]),_:1},8,["label"]),o(q,{label:e.$t("common.description"),"min-width":"200"},{default:d(({row:v})=>[P(E(v.description),1)]),_:1},8,["label"]),o(q,{label:e.$t("menu.permissions"),"min-width":"200"},{default:d(({row:v})=>[P(E(v.permission_infos?.map(x=>x.name).join(", ")),1)]),_:1},8,["label"]),o(q,{label:e.$t("common.actions"),width:"200",fixed:"right"},{default:d(({row:v})=>[o(B,{size:"small",onClick:x=>$(v)},{default:d(()=>[P(E(e.$t("common.edit")),1)]),_:2},1032,["onClick"]),o(B,{size:"small",type:"danger",onClick:x=>J(v.id)},{default:d(()=>[P(E(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"]),I("div",ya,[o(Ve,{background:"",layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],"page-size":i.value,"current-page":f.value,total:g.value,onCurrentChange:T,onSizeChange:V},null,8,["page-size","current-page","total"])])]),_:1}),o(we,{modelValue:k.visible,"onUpdate:modelValue":u[5]||(u[5]=v=>k.visible=v),title:k.mode==="create"?e.$t("common.create"):e.$t("common.edit"),width:"820px"},{footer:d(()=>[o(B,{onClick:u[4]||(u[4]=v=>k.visible=!1)},{default:d(()=>[P(E(e.$t("common.cancel")),1)]),_:1}),o(B,{type:"primary",onClick:R},{default:d(()=>[P(E(e.$t("common.confirm")),1)]),_:1})]),default:d(()=>[o(Te,{"label-width":"140px",ref_key:"formRef",ref:A,model:p,rules:M},{default:d(()=>[o(Z,{label:e.$t("common.name"),prop:"name"},{default:d(()=>[o(L,{modelValue:p.name,"onUpdate:modelValue":u[1]||(u[1]=v=>p.name=v)},null,8,["modelValue"])]),_:1},8,["label"]),o(Z,{label:e.$t("common.description"),prop:"description"},{default:d(()=>[o(L,{modelValue:p.description,"onUpdate:modelValue":u[2]||(u[2]=v=>p.description=v),type:"textarea"},null,8,["modelValue"])]),_:1},8,["label"]),o(Z,{label:e.$t("menu.permissions"),prop:"permission_ids"},{default:d(()=>[o($e,{modelValue:p.permission_ids,"onUpdate:modelValue":u[3]||(u[3]=v=>p.permission_ids=v),data:b.value,titles:[e.$t("common.available"),e.$t("common.assigned")],filterable:""},null,8,["modelValue","data","titles"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{$a as default};
