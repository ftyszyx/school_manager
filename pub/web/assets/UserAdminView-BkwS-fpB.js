import{m as Ue,p as ie,q as Ce,s as Oe,v as ve,x as Te,_ as Pe,d as ge,y as Le,z as De,A as xe,B as Ae,C as Be,D as Ye,r as _,E as Xe,G as je,c as z,H as $e,o as Ie,I as ue,J,h as p,w as n,i as s,T as He,e as E,n as Se,K as I,j as a,L as qe,f as S,b as y,M as Q,N as Ke,O as G,P as We,F as q,Q as Ze,S as Ge,k as B,t as N,U as Je,V as Qe,W as ea,X as aa,Y as sa,g as pe,Z as ta,$ as la,a0 as re,a1 as Me,a2 as Fe,a3 as na,a4 as oa,a5 as ra,a6 as ia,a7 as Ve,a8 as ua,a9 as Ne,aa as Re,ab as ca,ac as da,ad as ma,ae as fa,af as he,ag as pa,ah as _e,ai as va,aj as ga,ak as _a,al as wa,am as ha,an as we}from"./index-TzivwsyV.js";import{g as ba}from"./roles-g8JascAK.js";import{a as ya}from"./classes-B9YAiphQ.js";import{d as ka,E as Ca,a as $a,b as Ia,c as Ea,e as za,f as La,g as Sa,h as Va}from"./index-q58DMnPQ.js";import{_ as Na}from"./_plugin-vue_export-helper-DlAUqK2U.js";var Ra="Expected a function";function ke(u,k,v){var m=!0,f=!0;if(typeof u!="function")throw new TypeError(Ra);return Ue(v)&&(m="leading"in v?!!v.leading:m,f="trailing"in v?!!v.trailing:f),ka(u,k,{leading:m,maxWait:k,trailing:f})}const Oa=(u,k)=>{if(!ie||!u||!k)return!1;const v=u.getBoundingClientRect();let m;return k instanceof Element?m=k.getBoundingClientRect():m={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},v.top<m.bottom&&v.bottom>m.top&&v.right>m.left&&v.left<m.right},Ta=Oe({urlList:{type:ve(Array),default:()=>Te([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:ve(String)}}),Pa={close:()=>!0,switch:u=>Ce(u),rotate:u=>Ce(u)},Aa=ge({name:"ElImageViewer"}),Ba=ge({...Aa,props:Ta,emits:Pa,setup(u,{expose:k,emit:v}){var m;const f=u,w={CONTAIN:{name:"contain",icon:Le(xe)},ORIGINAL:{name:"original",icon:Le(De)}};let Y,K="";const{t:M}=Ae(),c=Be("image-viewer"),{nextZIndex:C}=Ye(),R=_(),W=_([]),X=Xe(),h=_(!0),$=_(f.initialIndex),F=je(w.CONTAIN),r=_({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),te=_((m=f.zIndex)!=null?m:C()),i=z(()=>{const{urlList:t}=f;return t.length<=1}),le=z(()=>$.value===0),ee=z(()=>$.value===f.urlList.length-1),ae=z(()=>f.urlList[$.value]),ce=z(()=>[c.e("btn"),c.e("prev"),c.is("disabled",!f.infinite&&le.value)]),de=z(()=>[c.e("btn"),c.e("next"),c.is("disabled",!f.infinite&&ee.value)]),e=z(()=>{const{scale:t,deg:b,offsetX:g,offsetY:P,enableTransition:D}=r.value;let x=g/t,Z=P/t;const fe=b*Math.PI/180,Ee=Math.cos(fe),ze=Math.sin(fe);x=x*Ee+Z*ze,Z=Z*Ee-g/t*ze;const ye={transform:`scale(${t}) rotate(${b}deg) translate(${x}px, ${Z}px)`,transition:D?"transform .3s":""};return F.value.name===w.CONTAIN.name&&(ye.maxWidth=ye.maxHeight="100%"),ye}),d=z(()=>`${$.value+1} / ${f.urlList.length}`);function A(){se(),Y?.(),document.body.style.overflow=K,v("close")}function O(){const t=ke(g=>{switch(g.code){case re.esc:f.closeOnPressEscape&&A();break;case re.space:T();break;case re.left:ne();break;case re.up:U("zoomIn");break;case re.right:oe();break;case re.down:U("zoomOut");break}}),b=ke(g=>{const P=g.deltaY||g.deltaX;U(P<0?"zoomIn":"zoomOut",{zoomRate:f.zoomRate,enableTransition:!1})});X.run(()=>{ue(document,"keydown",t),ue(document,"wheel",b)})}function se(){X.stop()}function V(){h.value=!1}function me(t){h.value=!1,t.target.alt=M("el.image.error")}function l(t){if(h.value||t.button!==0||!R.value)return;r.value.enableTransition=!1;const{offsetX:b,offsetY:g}=r.value,P=t.pageX,D=t.pageY,x=ke(fe=>{r.value={...r.value,offsetX:b+fe.pageX-P,offsetY:g+fe.pageY-D}}),Z=ue(document,"mousemove",x);ue(document,"mouseup",()=>{Z()}),t.preventDefault()}function L(){r.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function T(){if(h.value)return;const t=la(w),b=Object.values(w),g=F.value.name,D=(b.findIndex(x=>x.name===g)+1)%t.length;F.value=w[t[D]],L()}function j(t){const b=f.urlList.length;$.value=(t+b)%b}function ne(){le.value&&!f.infinite||j($.value-1)}function oe(){ee.value&&!f.infinite||j($.value+1)}function U(t,b={}){if(h.value)return;const{minScale:g,maxScale:P}=f,{zoomRate:D,rotateDeg:x,enableTransition:Z}={zoomRate:f.zoomRate,rotateDeg:90,enableTransition:!0,...b};switch(t){case"zoomOut":r.value.scale>g&&(r.value.scale=Number.parseFloat((r.value.scale/D).toFixed(3)));break;case"zoomIn":r.value.scale<P&&(r.value.scale=Number.parseFloat((r.value.scale*D).toFixed(3)));break;case"clockwise":r.value.deg+=x,v("rotate",r.value.deg);break;case"anticlockwise":r.value.deg-=x,v("rotate",r.value.deg);break}r.value.enableTransition=Z}function be(t){var b;((b=t.detail)==null?void 0:b.focusReason)==="pointer"&&t.preventDefault()}function o(){f.closeOnPressEscape&&A()}function H(t){if(t.ctrlKey){if(t.deltaY<0)return t.preventDefault(),!1;if(t.deltaY>0)return t.preventDefault(),!1}}return $e(ae,()=>{Me(()=>{const t=W.value[0];t?.complete||(h.value=!0)})}),$e($,t=>{L(),v("switch",t)}),Ie(()=>{O(),Y=ue("wheel",H,{passive:!1}),K=document.body.style.overflow,document.body.style.overflow="hidden"}),k({setActiveItem:j}),(t,b)=>(p(),J(a(ta),{to:"body",disabled:!t.teleported},{default:n(()=>[s(He,{name:"viewer-fade",appear:""},{default:n(()=>[E("div",{ref_key:"wrapper",ref:R,tabindex:-1,class:I(a(c).e("wrapper")),style:Se({zIndex:te.value})},[s(a(qe),{loop:"",trapped:"","focus-trap-el":R.value,"focus-start-el":"container",onFocusoutPrevented:be,onReleaseRequested:o},{default:n(()=>[E("div",{class:I(a(c).e("mask")),onClick:Ke(g=>t.hideOnClickModal&&A(),["self"])},null,10,["onClick"]),S(" CLOSE "),E("span",{class:I([a(c).e("btn"),a(c).e("close")]),onClick:A},[s(a(G),null,{default:n(()=>[s(a(We))]),_:1})],2),S(" ARROW "),a(i)?S("v-if",!0):(p(),y(q,{key:0},[E("span",{class:I(a(ce)),onClick:ne},[s(a(G),null,{default:n(()=>[s(a(Ze))]),_:1})],2),E("span",{class:I(a(de)),onClick:oe},[s(a(G),null,{default:n(()=>[s(a(Ge))]),_:1})],2)],64)),t.$slots.progress||t.showProgress?(p(),y("div",{key:1,class:I([a(c).e("btn"),a(c).e("progress")])},[Q(t.$slots,"progress",{activeIndex:$.value,total:t.urlList.length},()=>[B(N(a(d)),1)])],2)):S("v-if",!0),S(" ACTIONS "),E("div",{class:I([a(c).e("btn"),a(c).e("actions")])},[E("div",{class:I(a(c).e("actions__inner"))},[Q(t.$slots,"toolbar",{actions:U,prev:ne,next:oe,reset:T,activeIndex:$.value,setActiveItem:j},()=>[s(a(G),{onClick:g=>U("zoomOut")},{default:n(()=>[s(a(Je))]),_:1},8,["onClick"]),s(a(G),{onClick:g=>U("zoomIn")},{default:n(()=>[s(a(Qe))]),_:1},8,["onClick"]),E("i",{class:I(a(c).e("actions__divider"))},null,2),s(a(G),{onClick:T},{default:n(()=>[(p(),J(ea(a(F).icon)))]),_:1}),E("i",{class:I(a(c).e("actions__divider"))},null,2),s(a(G),{onClick:g=>U("anticlockwise")},{default:n(()=>[s(a(aa))]),_:1},8,["onClick"]),s(a(G),{onClick:g=>U("clockwise")},{default:n(()=>[s(a(sa))]),_:1},8,["onClick"])])],2)],2),S(" CANVAS "),E("div",{class:I(a(c).e("canvas"))},[(p(!0),y(q,null,pe(t.urlList,(g,P)=>(p(),y(q,{key:P},[P===$.value?(p(),y("img",{key:0,ref_for:!0,ref:D=>W.value[P]=D,src:g,style:Se(a(e)),class:I(a(c).e("img")),crossorigin:t.crossorigin,onLoad:V,onError:me,onMousedown:l},null,46,["src","crossorigin"])):S("v-if",!0)],64))),128))],2),Q(t.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var Ma=Pe(Ba,[["__file","image-viewer.vue"]]);const Fa=Fe(Ma),Ua=Oe({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:ve([String,Object])},previewSrcList:{type:ve(Array),default:()=>Te([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:ve(String)}}),Da={load:u=>u instanceof Event,error:u=>u instanceof Event,switch:u=>Ce(u),close:()=>!0,show:()=>!0},xa=ge({name:"ElImage",inheritAttrs:!1}),Ya=ge({...xa,props:Ua,emits:Da,setup(u,{expose:k,emit:v}){const m=u,{t:f}=Ae(),w=Be("image"),Y=na(),K=z(()=>oa(Object.entries(Y).filter(([l])=>/^(data-|on[A-Z])/i.test(l)||["id","style"].includes(l)))),M=ra({excludeListeners:!0,excludeKeys:z(()=>Object.keys(K.value))}),c=_(),C=_(!1),R=_(!0),W=_(!1),X=_(),h=_(),$=ie&&"loading"in HTMLImageElement.prototype;let F;const r=z(()=>[w.e("inner"),i.value&&w.e("preview"),R.value&&w.is("loading")]),te=z(()=>{const{fit:l}=m;return ie&&l?{objectFit:l}:{}}),i=z(()=>{const{previewSrcList:l}=m;return ia(l)&&l.length>0}),le=z(()=>{const{previewSrcList:l,initialIndex:L}=m;let T=L;return L>l.length-1&&(T=0),T}),ee=z(()=>m.loading==="eager"?!1:!$&&m.loading==="lazy"||m.lazy),ae=()=>{ie&&(R.value=!0,C.value=!1,c.value=m.src)};function ce(l){R.value=!1,C.value=!1,v("load",l)}function de(l){R.value=!1,C.value=!0,v("error",l)}function e(){Oa(X.value,h.value)&&(ae(),O())}const d=fa(e,200,!0);async function A(){var l;if(!ie)return;await Me();const{scrollContainer:L}=m;ca(L)?h.value=L:da(L)&&L!==""?h.value=(l=document.querySelector(L))!=null?l:void 0:X.value&&(h.value=ma(X.value)),h.value&&(F=ue(h,"scroll",d),setTimeout(()=>e(),100))}function O(){!ie||!h.value||!d||(F?.(),h.value=void 0)}function se(){i.value&&(W.value=!0,v("show"))}function V(){W.value=!1,v("close")}function me(l){v("switch",l)}return $e(()=>m.src,()=>{ee.value?(R.value=!0,C.value=!1,O(),A()):ae()}),Ie(()=>{ee.value?A():ae()}),k({showPreview:se}),(l,L)=>(p(),y("div",Ve({ref_key:"container",ref:X},a(K),{class:[a(w).b(),l.$attrs.class]}),[C.value?Q(l.$slots,"error",{key:0},()=>[E("div",{class:I(a(w).e("error"))},N(a(f)("el.image.error")),3)]):(p(),y(q,{key:1},[c.value!==void 0?(p(),y("img",Ve({key:0},a(M),{src:c.value,loading:l.loading,style:a(te),class:a(r),crossorigin:l.crossorigin,onClick:se,onLoad:ce,onError:de}),null,16,["src","loading","crossorigin"])):S("v-if",!0),R.value?(p(),y("div",{key:1,class:I(a(w).e("wrapper"))},[Q(l.$slots,"placeholder",{},()=>[E("div",{class:I(a(w).e("placeholder"))},null,2)])],2)):S("v-if",!0)],64)),a(i)?(p(),y(q,{key:2},[W.value?(p(),J(a(Fa),{key:0,"z-index":l.zIndex,"initial-index":a(le),infinite:l.infinite,"zoom-rate":l.zoomRate,"min-scale":l.minScale,"max-scale":l.maxScale,"show-progress":l.showProgress,"url-list":l.previewSrcList,crossorigin:l.crossorigin,"hide-on-click-modal":l.hideOnClickModal,teleported:l.previewTeleported,"close-on-press-escape":l.closeOnPressEscape,onClose:V,onSwitch:me},ua({toolbar:n(T=>[Q(l.$slots,"toolbar",Ne(Re(T)))]),default:n(()=>[l.$slots.viewer?(p(),y("div",{key:0},[Q(l.$slots,"viewer")])):S("v-if",!0)]),_:2},[l.$slots.progress?{name:"progress",fn:n(T=>[Q(l.$slots,"progress",Ne(Re(T)))])}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):S("v-if",!0)],64)):S("v-if",!0)],16))}});var Xa=Pe(Ya,[["__file","image.vue"]]);const ja=Fe(Xa),Ha=async u=>(await he.get("/api/admin/users",{params:u})).data;async function qa(u){return(await he.post("/api/admin/users",u)).data}async function Ka(u,k){return(await he.put(`/api/admin/users/${u}`,k)).data}async function Wa(u){return(await he.delete(`/api/admin/users/${u}`)).data}const Za={class:"space-y-4"},Ga={class:"flex items-center gap-2"},Ja={key:0,class:"wechat-info"},Qa={class:"wechat-nickname"},es={class:"flex justify-end mt-4"},as=ge({__name:"UserAdminView",setup(u){const k=_([]),v=_([]),m=_([]),f=_([]),w=_(1),Y=_(20),K=_(0),{t:M}=pa(),c=_e({username:""});async function C(){const e=await Ha({page:w.value,page_size:Y.value,username:c.username||void 0});k.value=e.list,K.value=e.total}async function R(){const e=await ba({page:1,page_size:1e3});m.value=e.list}async function W(){const e=await ya({page:1,page_size:1e3});f.value=e.list}function X(){c.username="",w.value=1,C()}function h(e){v.value=e.map(d=>d.id)}function $(e){w.value=e,C()}function F(e){Y.value=e,w.value=1,C()}const r=_e({visible:!1,mode:"create",editingId:void 0}),te=_(),i=_e({username:"",password:"",role_ids:[],class_ids:[]}),le=_e({username:[{required:!0,message:"Username required"}]});function ee(){r.mode="create",r.editingId=void 0,i.username="",i.password="",i.role_ids=[],i.class_ids=[],r.visible=!0}function ae(e){r.mode="edit",r.editingId=e.id,i.username=e.username,i.password="",i.role_ids=e.role_infos.map(d=>d.role_id),i.class_ids=e.class_infos.map(d=>d.class_id),r.visible=!0}async function ce(){if(!await te.value?.validate()){we.error(M("common.please_check_form"));return}r.mode==="create"?(await qa({username:i.username,password:i.password||"",role_ids:i.role_ids,class_ids:i.class_ids}),we.success(M("common.created"))):r.editingId!=null&&(await Ka(r.editingId,{username:i.username,role_ids:i.role_ids,class_ids:i.class_ids}),we.success(M("common.save"))),r.visible=!1,await C()}async function de(e){await Va.confirm(M("common.delete_confirm",{name:k.value.find(d=>d.id===e)?.username||""}),M("common.confirm"),{type:"warning"}),await Wa(e),we.success(M("common.deleted")),C()}return Ie(()=>{C(),R(),W()}),(e,d)=>{const A=ga,O=_a,se=Ca,V=Ia,me=ja,l=Ea,L=$a,T=za,j=ha,ne=Sa,oe=La,U=wa,be=va;return p(),y("div",Za,[s(se,{shadow:"hover"},{default:n(()=>[E("div",Ga,[s(A,{modelValue:c.username,"onUpdate:modelValue":d[0]||(d[0]=o=>c.username=o),placeholder:e.$t("common.search_by_name"),clearable:"",class:"w-64"},null,8,["modelValue","placeholder"]),s(O,{type:"primary",onClick:C},{default:n(()=>[B(N(e.$t("common.search")),1)]),_:1}),s(O,{onClick:X},{default:n(()=>[B(N(e.$t("common.reset")),1)]),_:1}),s(O,{type:"success",onClick:ee},{default:n(()=>[B(N(e.$t("common.new")),1)]),_:1})])]),_:1}),s(se,{shadow:"never"},{default:n(()=>[s(L,{data:k.value,stripe:"",size:"large",style:{width:"100%"},onSelectionChange:h},{default:n(()=>[s(V,{type:"selection",width:"50"}),s(V,{prop:"id",label:"ID",width:"80"}),s(V,{prop:"username",label:e.$t("user.username"),width:"180"},null,8,["label"]),s(V,{prop:"school_name",label:e.$t("user.school_name"),width:"180"},null,8,["label"]),s(V,{label:e.$t("user.wechat_info"),width:"220"},{default:n(({row:o})=>[o.wechat_nickname?(p(),y("div",Ja,[s(me,{style:{width:"40px",height:"40px","border-radius":"50%"},src:o.wechat_avatar_url,fit:"cover","preview-src-list":[o.wechat_avatar_url],"preview-teleported":""},null,8,["src","preview-src-list"]),E("span",Qa,N(o.wechat_nickname),1)])):S("",!0)]),_:1},8,["label"]),s(V,{prop:"role_infos",label:e.$t("user.roles")},{default:n(({row:o})=>[(p(!0),y(q,null,pe(o.role_infos,H=>(p(),J(l,{key:H.role_id,class:"role-tag"},{default:n(()=>[B(N(H.role_name),1)]),_:2},1024))),128))]),_:1},8,["label"]),s(V,{prop:"class_infos",label:e.$t("menu.classes")},{default:n(({row:o})=>[(p(!0),y(q,null,pe(o.class_infos,H=>(p(),J(l,{key:H.class_id,class:"class-tag"},{default:n(()=>[B(N(H.class_name),1)]),_:2},1024))),128))]),_:1},8,["label"]),s(V,{prop:"created_at",label:e.$t("user.created_at"),width:"180"},{default:n(({row:o})=>[B(N(new Date(o.created_at).toLocaleString()),1)]),_:1},8,["label"]),s(V,{label:e.$t("common.operations"),width:"150"},{default:n(({row:o})=>[s(O,{type:"primary",size:"small",onClick:H=>ae(o)},{default:n(()=>[B(N(e.$t("common.edit")),1)]),_:2},1032,["onClick"]),s(O,{size:"small",type:"danger",onClick:H=>de(o.id)},{default:n(()=>[B(N(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"]),E("div",es,[s(T,{background:"",layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],"page-size":Y.value,"current-page":w.value,total:K.value,onCurrentChange:$,onSizeChange:F},null,8,["page-size","current-page","total"])])]),_:1}),s(be,{modelValue:r.visible,"onUpdate:modelValue":d[6]||(d[6]=o=>r.visible=o),title:r.mode==="create"?e.$t("common.create"):e.$t("common.edit"),width:"520px"},{footer:n(()=>[s(O,{onClick:d[5]||(d[5]=o=>r.visible=!1)},{default:n(()=>[B(N(e.$t("common.cancel")),1)]),_:1}),s(O,{type:"primary",onClick:ce},{default:n(()=>[B(N(e.$t("common.confirm")),1)]),_:1})]),default:n(()=>[s(U,{"label-width":"140px",ref_key:"formRef",ref:te,model:i,rules:le},{default:n(()=>[s(j,{label:e.$t("auth.username"),prop:"username"},{default:n(()=>[s(A,{modelValue:i.username,"onUpdate:modelValue":d[1]||(d[1]=o=>i.username=o)},null,8,["modelValue"])]),_:1},8,["label"]),s(j,{label:e.$t("menu.roles"),prop:"role_ids"},{default:n(()=>[s(oe,{modelValue:i.role_ids,"onUpdate:modelValue":d[2]||(d[2]=o=>i.role_ids=o),multiple:"",class:"w-full"},{default:n(()=>[(p(!0),y(q,null,pe(m.value,o=>(p(),J(ne,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),s(j,{label:e.$t("menu.classes"),prop:"class_ids"},{default:n(()=>[s(oe,{modelValue:i.class_ids,"onUpdate:modelValue":d[3]||(d[3]=o=>i.class_ids=o),multiple:"",class:"w-full"},{default:n(()=>[(p(!0),y(q,null,pe(f.value,o=>(p(),J(ne,{key:o.id,label:`${o.school_name} ${o.grade}年级${o.class}班`,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),r.mode==="create"?(p(),J(j,{key:0,label:e.$t("auth.password"),prop:"password"},{default:n(()=>[s(A,{modelValue:i.password,"onUpdate:modelValue":d[4]||(d[4]=o=>i.password=o),type:"password"},null,8,["modelValue"])]),_:1},8,["label"])):S("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}}),rs=Na(as,[["__scopeId","data-v-46f7a77a"]]);export{rs as default};
